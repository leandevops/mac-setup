#!/usr/bin/env bash

# Exit on any individual command failure.
set -e

# Pretty colors.
red='\033[0;31m'
green='\033[0;32m'
neutral='\033[0m'

# Shared functions
pretty_print() {
  printf "\n%b\n" "$1"
}

pretty_print "${green}Starting ...${neutral}"

# Oh my zsh installation
if [ ! -d "$HOME/.oh-my-zsh" ]; then
  pretty_print "Installing oh-my-zsh..."
  curl -L http://install.ohmyz.sh | sh
else
  pretty_print "oh-my-zsh is already installed, skipping ..."
fi

# Homebrew installation
if ! command -v brew &>/dev/null; then
  pretty_print "Installing Homebrew, an OSX package manager, follow the instructions..." 
    ruby -e "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/master/install)"

  if ! grep -qs "recommended by brew doctor" ~/.zshrc; then
    pretty_print "Put Homebrew location earlier in PATH ..."
      printf '\n# recommended by brew doctor\n' >> ~/.zshrc
      printf 'export PATH="/usr/local/bin:$PATH"\n' >> ~/.zshrc
      export PATH="/usr/local/bin:$PATH"
  fi
else
  pretty_print "You already have Homebrew installed...good job!"
fi

pretty_print "Updating brew formulas"
  brew update &>/dev/null

make all

# The list of vs code extensions
extensions=$(cat install/Codefile)

# Installing vscode extensions
for ext in "${extensions[@]}"
do
  code --install-extension --force $ext
done

# Install python packages
pip3 install ansible ansible-lint awscli

pretty_print "Copying configs to .configs directory"
mkdir -p ~/.config
cp -R .config/* ~/.config

pretty_print "Installing fonts"
cd ~/Library/Fonts && { 
    curl -s 'https://github.com/romkatv/powerlevel10k-media/raw/master/MesloLGS%20NF%20Regular.ttf' --output 'MesloLGS NF Regular.ttf'
    curl -s 'https://github.com/romkatv/powerlevel10k-media/raw/master/MesloLGS%20NF%20Bold.ttf' --output 'MesloLGS NF Bold.ttf'
    curl -s 'https://github.com/romkatv/powerlevel10k-media/raw/master/MesloLGS%20NF%20Italic.ttf' --output 'MesloLGS NF Italic.ttf'
    curl -s 'https://github.com/romkatv/powerlevel10k-media/raw/master/MesloLGS%20NF%20Bold%20Italic.ttf' --output 'MesloLGS NF Bold Italic.ttf'
    cd -; 
}

pretty_print "${green}We are done!...everything looks good!${neutral}"
